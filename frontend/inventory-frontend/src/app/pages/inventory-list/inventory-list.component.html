<div class="d-flex justify-content-between align-items-center mb-3">
  <h2>Inventory</h2>
  <div class="d-flex gap-2">
    <button class="btn btn-primary" (click)="goToAdd()">Add Item</button>
    <button class="btn btn-secondary" (click)="goToStats()">Statistics</button>
  </div>
</div>

<div class="mb-3 d-flex align-items-center gap-2">
  <label for="locationFilter" class="form-label mb-0">Location:</label>
  <select
    id="locationFilter"
    class="form-select w-auto"
    [(ngModel)]="selectedLocationId"
    (change)="onLocationChange()"
  >
    <option [ngValue]="null">All</option>
    <option *ngFor="let loc of locations" [ngValue]="loc.id">
      {{ loc.name }}
    </option>
  </select>
</div>

<div *ngIf="error" class="alert alert-danger">{{ error }}</div>
<div *ngIf="loading">Loading...</div>

<table class="table table-striped" *ngIf="!loading && items.length">
  <thead>
    <tr>
      <th (click)="changeSort('name')" style="cursor: pointer">
        Item name
        <span *ngIf="sortBy === 'name'">
          {{ sortDir === "asc" ? "▲" : "▼" }}
        </span>
      </th>
      <th (click)="changeSort('location')" style="cursor: pointer">
        Item location
        <span *ngIf="sortBy === 'location'">
          {{ sortDir === "asc" ? "▲" : "▼" }}
        </span>
      </th>
      <th (click)="changeSort('price')" style="cursor: pointer">
        Price (GEL)
        <span *ngIf="sortBy === 'price'">
          {{ sortDir === "asc" ? "▲" : "▼" }}
        </span>
      </th>
      <th>Operations</th>
    </tr>
  </thead>
  <tbody>
    <tr *ngFor="let item of items">
      <td>{{ item.name }}</td>
      <td>{{ item.Location?.name }}</td>
      <td>{{ item.price }}</td>
      <td>
        <button class="btn btn-sm btn-danger" (click)="deleteItem(item)">
          Delete
        </button>
      </td>
    </tr>
  </tbody>
</table>

<div *ngIf="!loading && !items.length" class="alert alert-info">
  No items found.
</div>

<div
  class="d-flex justify-content-between align-items-center mt-3"
  *ngIf="total > 0"
>
  <div>Total items: {{ total }}</div>
  <div class="d-flex align-items-center gap-2">
    <button
      class="btn btn-outline-secondary btn-sm"
      (click)="prevPage()"
      [disabled]="page === 1"
    >
      Previous
    </button>
    <span>Page {{ page }} / {{ totalPages() }}</span>
    <button
      class="btn btn-outline-secondary btn-sm"
      (click)="nextPage()"
      [disabled]="page === totalPages()"
    >
      Next
    </button>
  </div>
</div>
